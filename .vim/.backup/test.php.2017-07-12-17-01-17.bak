<?php

include __DIR__.'/comm.php';


$array = array(
"psword"=>"111111",
"ttype"=>3,
"mid"=>189630520,
"smallBlind"=>5000,
"prechipsRate"=>2,
"isPsword"=>1
);
print_r($arra);

exit();

oo::$config['sid'] = 117;
oo::$config['MongoBase'] = array(
    'replicaSet' => 'pktest',
    'servers' => array(
        '0' => array('192.168.202.94', '5000'),
        '1' => array('192.168.202.91', '5000')
    )
);
$mid = 88121;
$type = 3;
$devid = '99a069075d47d809f0cf09fb6c287502';




$devid = '279f9e9ac04646268d000e249f9fa929';
$fromtxmid = 58610;
                $t = oo::logs()->mgtblmobilemap();
                $t = $t.'tx';
                $mids = ocache::mongoMobilemap()->getOne($t, array('_id'=>$devid), array('mids'));
                if($mids) $mids = $mids['mids'];
                if($mids){
                    foreach (array_keys($mids, "$fromtxmid", true) as $key) {
                        unset($mids[$key]);
                    }                    
                    $aUpd = array('mids' => $mids);
                    print_r($aUpd);
                    ocache::mongoMobilemap()->update($t, array('_id'=>$devid), array('$set'=>$aUpd));
                }




exit();
//print_r(oo::appeal()->getInfoById($mid, $devid));
//var_dump(oo::appeal()->saveInfo(array('fromtxmid' => '', 'notes' =>'', 'type' => 3, 'mid' => '88121', 'devid'=>'99a069075d47d809f0cf09fb6c287502')));


$table = oo::logs()->mgtblmobilemap();
if(oo::$config['sid'] == 93) $table = $table.'tx';
$u = oo::member()->getOneById('', false);
print_r($u);
exit();
/*
$arr = ocache::mongoMobilemap()->getAll($table, array());
foreach($arr as $key => $val){
        if(strlen($val['_id']) == 32) print_r($val);
}


$insert_data = array(
    'c84b05d97f5a38acfb1402cf564f567d' => array('1', '2')
);
if($insert_data){
    foreach($insert_data as $key => $val){
        $aUpd = array('mids' => $val);
        ocache::mongoMobilemap()->update($table, array('_id'=>$key), array('$set'=>$aUpd));
    }
}
 */
//

/*
$tmid = 6044;
$arr = oo::boyaauser()->mbtxToSinaNotToken($tmid, $mid);
print_r($arr);
 */

//$devid = 'c84b05d97f5a38acfb1402cf564f567d';
//$mids = array();
//    $mids = ocache::mongoMobilemap()->getOne($table, array('_id'=>$devid), array('mids'));
//print_r($mids);

$temp = array();
$arr = ocache::mongoMobilemap()->getAll('texas_93_mobilemap.mobilemap', array());
ocache::mongoMobilemap()->remove('texas_93_mobilemap.mobilemaptx', array());
foreach($arr as $key => $val){
    $u = oo::member()->getOneById($val['mid'], false);
    if($u && isset($u['mstatus']) && $u['mstatus'] != 1 && $u['mstatus'] != 0){
        $temp[$val['key']][] = $val['mid'];
    }
}
    foreach($temp as $key => $val){
        $aUpd = array('mids' => $val);
        ocache::mongoMobilemap()->update('texas_93_mobilemap.mobilemaptx', array('_id'=>$key), array('$set'=>$aUpd));
    }
