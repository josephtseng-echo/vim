<?php
if (isset($_SERVER['HTTP_CCGATE']) && $_SERVER['HTTP_CCGATE'] ==2) {	
	define('IN_SWOOLEGATEWAY',true);
}
define('IN_WEB', true);
define('IN_API', true);
define('API_START_TIME', microtime(true)); //此次请求开始时间
if(isset($_REQUEST['callback'])){
	define('IN_HTML5', true);
}
$dir = dirname(__FILE__) . '/';
include($dir . "../common.php");
if(  ! ( PRODUCTION_SERVER || in_array( SERVER_TYPE, array('vm','demo')) ) ){
	//var_dump(oo::$config['sid']);
	die('-999');
}

//用于内部测试，获取部分线上host主机信息
if(isset($_GET['t']) && ('mb.boyaa' == $_GET['t']) && of::isBoyaaIp()){
	echo 'SERVER_ADDR:',$_SERVER['SERVER_ADDR'],"\n";
	echo 'HOSTNAME:',php_uname('n'),"\n";
	echo 'PHP_VERSION:',PHP_VERSION,"\n";
	echo 'HTTP_HOST:',$_SERVER['HTTP_HOST'],"\n";
	echo '__FILE__:',__FILE__,"\n";
	echo 'OSIP:',functions::osip(),"\n";
	echo 'btea ',(extension_loaded('btea') ? 'loaded' : 'not found'),"\n";
	echo 'mobile_api ',(extension_loaded('mobile_api') ? 'loaded' : 'not found'), "\n";
	echo 'DATE:',date('Y-m-d H:i:s');
	die(0);
}

//if ( defined('SERVER_TYPE') && (SERVER_TYPE == 'demo') && (oo::$config['sid'] == 67)){
	//印尼内网模拟主数据库挂掉
//	oo::$config['db_host'] = '192.123.0.0:3399';
//}

//if((oo::$config['sid'] == 57) && function_exists("xhprof_enable") && (mt_rand(1,100) == 1) ){
//	xhprof_enable(XHPROF_FLAGS_CPU + XHPROF_FLAGS_MEMORY);
//	define('XPHROF_ENAB', 1);
//}

if(of::isBoyaaIp()){//bydebug优化
	$_GET['debug'] = 'bydebug';
	$aM = json_decode($_REQUEST['api'], true);
    $_GET['file'] = 'v5.'.$aM['method'];
}
include(PATH_LIB . "mobile/class.dispatcher.php");

Dispatcher::dispatch();
