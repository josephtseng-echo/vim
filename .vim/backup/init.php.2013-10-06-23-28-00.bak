<?php
//
//if (GZIP && (stripos($_SERVER['HTTP_ACCEPT_ENCODING'], 'gzip') !==false)) ob_start('ob_gzhandler');
require_once 'xt.php';
require_once _CLASS_PATH_.'adodb/adodb.inc.php';
require_once _CLASS_PATH_.'smarty/Smarty.class.php';
require_once _CLASS_PATH_.'xt_func.php';
require_once _INC_PATH_.'config.php';
require_once _INC_PATH_.'db_tables.php';

if(isset($_REQUEST['act']) and !empty($_REQUEST['act'])){
	$_xt_act = trim($_REQUEST['act']);
	$_xt_act = strtolower($_xt_act);
}

if(isset($_REQUEST['lan']) and !empty($_REQUEST['lan']) 
	&& in_array($_REQUEST['lan'], array('zh', 'en'))){
	$_xt_lan = trim($_REQUEST['lan']);
	$_xt_lan = strtolower($_xt_lan);
}

/* databset start */
if($_xt_db == null){
	try{
		$_xt_db =& ADONewConnection(DB_TYPE);
		$ADODB_FETCH_MODE = ADODB_FETCH_ASSOC;
		$_db->debug = false;
		if(DB_TYPE == 'mysql'){//mysql
			$_xt_db->Connect(DB_HOST, DB_USER, DB_PWD, DB_NAME);
			$_xt_db->Execute("SET NAMES '".DB_CHAR."'");
		}elseif(DB_TYPE == 'ado_access'){ //access
			$_xt_db->charPage =65001;
			$_xt_db->Connect(DB_ACCESS_DSN);
		}else{ //默认是mysql
			$_xt_db->Connect(DB_HOST, DB_USER, DB_PWD, DB_NAME);
			$_xt_db->Execute("SET NAMES '".DB_CHAR."'");	
		}
	}catch (Exception $e){
		die($e->getMessage());
	}
}
/* databset end */

$sql = 'SELECT '.func_sql_fieldArrayToStr($_xt_tables_set['settings']['field']).' 
FROM '.DB_NAME.'.'.$_xt_tables_set['settings']['name'].' 
WHERE '.$_xt_tables_set['settings']['name'].'.lan="'.$_xt_lan.'" 
LIMIT 0, 1';
$_xt_web_set = func_adodb_fetchRow($_xt_db, $sql);
if($_xt_web_set){
	$_xt_web_set['web_url'] = WEB_URL;
}
if(_XT_IS_LAN_SET_){
	$_xt_web_set['xt_is_lan_set'] = _XT_IS_LAN_SET_;
}else{
	$_xt_web_set['xt_is_lan_set'] = 0;
}

$_web_set_data = &$_xt_web_set;
define('TPL_DEFAULT_NAME', $_xt_web_set['web_tpl']);
define('TPL_DEFAULT', _TPL_PATH_.TPL_DEFAULT_NAME.'/');

define('_FCK_UPLOAD_PATH_', $_xt_web_set['web_fck_upload_path']);

date_default_timezone_set($_xt_web_set['web_timezone']);

func_common_set_magic_quotes_gpc();
