<?php

namespace Oil\Form;

use St\Api;

class TankForm extends \St\Form\Form
{
	/**
     * Form basic elements
     *
     * @var array
     */
	protected $mergeElements = array( 
		'id' => array( 
			'name' => 'id', 
			'type' => 'hidden', 
			'options' => array( 
				'label' => 'Id' 
			), 
			'attributes' => array( 
				'value' => '' 
			) 
		), 
		'no' => array( 
			'name' => 'no', 
			'type' => 'hidden', 
			'options' => array( 
				'label' => 'no' 
			), 
			'attributes' => array( 
				'value' => '' 
			) 
		), 
		'oil_no' => array( 
				'name' => 'oil_no',
				'type' => 'select',
				'callback' => 'getOil',
				'options' => array(
						'label' => '油品:',
						'empty_option' => '--請選擇--',
						// 'value_options' => '',
				)
				,
				'attributes' => array(
						//  'value' => 'active'
				)
		), 
		'depot' => array( 
			'name' => 'depot', 
			'type' => 'text', 
			'options' => array( 
				'label' => '油槽:'
			), 
			'attributes' => array( 
				'value' => '' 
			) 
		),
			'station' => array(
					'name' => 'station',
					'type' => 'select',
					'callback' => 'getStation',
					'options' => array(
							'label' => '所屬站別:',
							//  'empty_option' => '請選擇用戶角色',
			
					),
			
			),			
	)
	;
	
	/**
     * Form basic Validators
     *
     * @var array
     */
	protected $mergeFilters = array( 
		'id' => array( 
			'name' => 'id', 
			'required' => false, 
			'filters' => array(), 
			'validators' => array( 
				'notEmpty' => array( 
					'name' => 'NotEmpty', 
					'options' => array() 
				) 
			) 
		), 
		'no' => array( 
			'name' => 'no', 
			'required' => false, 
			'filters' => array(), 
			'validators' => array( 
				'notEmpty' => array( 
					'name' => 'NotEmpty', 
					'options' => array() 
				) 
			) 
		), 
		'oil_no' => array( 
			'name' => 'oil_no', 
			'required' => true, 
			'filters' => array( 
				'stripTags' => array( 
					'name' => 'StripTags' 
				), 
				'stringTrim' => array( 
					'name' => 'StringTrim' 
				) 
			), 
			'validators' => array( 
				'notEmpty' => array( 
					'name' => 'NotEmpty', 
					'options' => array() 
				), 
				'stringLength' => array( 
					'name' => 'StringLength', 
					'options' => array( 
						'max' => '128' 
					) 
				) 
			) 
		), 

		'depot' => array(
				'name' => 'depot',
				'required' => true,
				'filters' => array(),
				'validators' => array(
						array(
								'name' => 'Regex',
								'options' => array(
										'pattern' => '/^[0-9a-z]{1,}$/i',
										'messages' => array(
												\Zend\Validator\Regex::NOT_MATCH => '請輸入數字字母或結合'
										),
								),
						)
				)
		),
	)
	;
	
	public function getOil($element)
	{
	
		$config=Api::_()->getConfig();
		$temp = array();
		if($config['oil']){
			foreach($config['oil'] as $key => $val){
				$temp[$key] = $val;
			}
		}
		$element['options']['value_options'] = $temp;
		return $element;
	
	}	

	public function getStation($element)
	{
		$itemModel = Api::_()->getModel('Oil\Model\Station');
		$items = $itemModel->getStations();
		array_unshift($items,'總公司');
		//p($items);
		$element['options']['value_options'] = $items;
		return $element;
	
	}	
	
}
